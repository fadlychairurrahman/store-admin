<!DOCTYPE html>
<html>
<head>
  <title>Data Pembelian</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="mb-4">ðŸ§¾ Data Pembelian</h2>

    <!-- Form Tambah / Edit Pembelian -->
    <form action="/pembelian/simpan" method="POST" class="mb-4">
      <input type="hidden" name="id" value="<%= editData ? editData.id : '' %>">

      <div class="row g-2 align-items-center">
        <div class="col-md-3">
          <select name="id_produk" class="form-select" required>
            <option value="">-- Pilih Produk --</option>
            <% produk.forEach(p => { %>
              <option value="<%= p.id %>" 
                <%= editData && editData.id_produk === p.id ? 'selected' : '' %>>
                <%= p.nama_produk %>
              </option>
            <% }) %>
          </select>
        </div>

        <div class="col-md-2">
          <input type="number" name="jumlah" placeholder="Jumlah" class="form-control" required 
                 value="<%= editData ? editData.jumlah : '' %>">
        </div>

        <div class="col-md-3">
          <select name="status" class="form-select" required>
            <option value="selesai" <%= editData && editData.status === 'selesai' ? 'selected' : '' %>>Selesai</option>
            <option value="diproses" <%= editData && editData.status === 'diproses' ? 'selected' : '' %>>Diproses</option>
            <option value="cancelled" <%= editData && editData.status === 'cancelled' ? 'selected' : '' %>>Dibatalkan</option>
          </select>
        </div>

        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100">
            <%= editData ? 'Update' : 'Tambah' %>
          </button>
        </div>

        <% if (editData) { %>
        <div class="col-md-2">
          <a href="/pembelian" class="btn btn-secondary w-100">Batal Edit</a>
        </div>
        <% } %>
      </div>
    </form>

    <!-- Tabel Pembelian -->
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Produk</th>
          <th>Jumlah</th>
          <th>Total Harga</th>
          <th>Tanggal</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <% if (pembelian.length > 0) { %>
          <% pembelian.forEach(b => { %>
            <tr>
              <td><%= b.id %></td>
              <td><%= b.nama_produk %></td>
              <td><%= b.jumlah %></td>
              <td>Rp <%= b.total_harga.toLocaleString() %></td>
              <td><%= new Date(b.tanggal).toLocaleString() %></td>
              <td>
                <% if (b.status === 'selesai') { %>
                  <span class="badge bg-success">Selesai</span>
                <% } else if (b.status === 'diproses') { %>
                  <span class="badge bg-warning text-dark">Diproses</span>
                <% } else { %>
                  <span class="badge bg-danger">Dibatalkan</span>
                <% } %>
              </td>
              <td>
                <a href="/pembelian/edit/<%= b.id %>" class="btn btn-sm btn-warning">Edit</a>
                <a href="/pembelian/hapus/<%= b.id %>" class="btn btn-sm btn-danger">Hapus</a>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="7" class="text-center">Belum ada data pembelian.</td></tr>
        <% } %>
      </tbody>
    </table>

    <a href="/" class="btn btn-secondary mt-3">â¬… Kembali</a>
  </div>
</body>
</html>
